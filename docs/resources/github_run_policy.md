---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "stepsecurity_github_run_policy Resource - stepsecurity"
subcategory: ""
description: |-
  Manages a GitHub Actions run policy in StepSecurity.
---

# stepsecurity_github_run_policy (Resource)

Manages a GitHub Actions run policy in StepSecurity.

## Example Usage

```terraform
terraform {
  required_providers {
    stepsecurity = {
      source = "step-security/stepsecurity"
    }
  }
}

provider "stepsecurity" {
  api_key  = "xxxxxxxx" # can also be set as env variable STEP_SECURITY_API_KEY
  customer = "abcdefg"  # can also be set as env variable STEP_SECURITY_CUSTOMER
}

# Action Policy Example (all_orgs) - Allows only specific GitHub Actions across all orgs
resource "stepsecurity_github_run_policy" "action_policy_all_orgs" {
  owner    = "my-org"
  name     = "Allowed Actions Policy - All Orgs"
  all_orgs = true

  policy_config = {
    owner                = "my-org"
    name                 = "Allowed Actions Policy - All Orgs"
    enable_action_policy = true
    allowed_actions = {
      "actions/checkout"            = "allow"
      "step-security/harden-runner" = "allow"
      "actions/setup-node"          = "allow"
      "actions/setup-python"        = "allow"
      "actions/upload-artifact"     = "allow"
    }
  }
}

# Action Policy Example (all_repos) - Allows only specific GitHub Actions across all repos
resource "stepsecurity_github_run_policy" "action_policy_all_repos" {
  owner     = "my-org"
  name      = "Allowed Actions Policy - All Repos"
  all_repos = true

  policy_config = {
    owner                = "my-org"
    name                 = "Allowed Actions Policy - All Repos"
    enable_action_policy = true
    allowed_actions = {
      "actions/checkout"            = "allow"
      "step-security/harden-runner" = "allow"
      "actions/setup-node"          = "allow"
      "actions/setup-python"        = "allow"
      "actions/upload-artifact"     = "allow"
    }
  }
}

# Action Policy Example (dry_run) - Test action policy without enforcement
resource "stepsecurity_github_run_policy" "action_policy_dry_run" {
  owner     = "my-org"
  name      = "Action Policy - Dry Run"
  all_repos = true

  policy_config = {
    owner                = "my-org"
    name                 = "Action Policy - Dry Run"
    enable_action_policy = true
    allowed_actions = {
      "actions/checkout"            = "allow"
      "step-security/harden-runner" = "allow"
    }
    is_dry_run = true
  }
}

# Runner Label Policy Example (all_repos) - Restricts which runners can be used
resource "stepsecurity_github_run_policy" "runner_policy_all_repos" {
  owner     = "my-org"
  name      = "Runner Label Policy - All Repos"
  all_repos = true

  policy_config = {
    owner                    = "my-org"
    name                     = "Runner Label Policy - All Repos"
    enable_runs_on_policy    = true
    disallowed_runner_labels = ["self-hosted", "windows-latest", "macos-latest"]
  }
}

# Runner Label Policy Example (all_orgs) - Restricts which runners can be used across all orgs
resource "stepsecurity_github_run_policy" "runner_policy_all_orgs" {
  owner    = "my-org"
  name     = "Runner Label Policy - All Orgs"
  all_orgs = true

  policy_config = {
    owner                    = "my-org"
    name                     = "Runner Label Policy - All Orgs"
    enable_runs_on_policy    = true
    disallowed_runner_labels = ["self-hosted", "windows-latest"]
  }
}

# Runner Label Policy Example (dry_run) - Test runner policy without enforcement
resource "stepsecurity_github_run_policy" "runner_policy_dry_run" {
  owner     = "my-org"
  name      = "Runner Label Policy - Dry Run"
  all_repos = true

  policy_config = {
    owner                    = "my-org"
    name                     = "Runner Label Policy - Dry Run"
    enable_runs_on_policy    = true
    disallowed_runner_labels = ["self-hosted"]
    is_dry_run               = true
  }
}

# Secrets Policy Example (all_orgs) - Prevents secrets from being exfiltrated across all orgs
resource "stepsecurity_github_run_policy" "secrets_policy_all_orgs" {
  owner    = "my-org"
  name     = "Secrets Policy - All Orgs"
  all_orgs = true

  policy_config = {
    owner                 = "my-org"
    name                  = "Secrets Policy - All Orgs"
    enable_secrets_policy = true
    exempted_users        = ["dependabot[bot]", "renovate[bot]"]
  }
}

# Secrets Policy Example (all_repos) - Prevents secrets from being exfiltrated across all repos
resource "stepsecurity_github_run_policy" "secrets_policy_all_repos" {
  owner     = "my-org"
  name      = "Secrets Policy - All Repos"
  all_repos = true

  policy_config = {
    owner                 = "my-org"
    name                  = "Secrets Policy - All Repos"
    enable_secrets_policy = true
    exempted_users        = ["dependabot[bot]", "github_username"]
  }
}

# Secrets Policy Example (dry_run) - Test secrets policy without enforcement
resource "stepsecurity_github_run_policy" "secrets_policy_dry_run" {
  owner     = "my-org"
  name      = "Secrets Policy - Dry Run"
  all_repos = true

  policy_config = {
    owner                 = "my-org"
    name                  = "Secrets Policy - Dry Run"
    enable_secrets_policy = true
    is_dry_run            = true
  }
}

# Compromised Actions Policy Example (all_orgs) - Blocks known compromised actions across all orgs
resource "stepsecurity_github_run_policy" "compromised_actions_policy_all_orgs" {
  owner    = "my-org"
  name     = "Compromised Actions Policy - All Orgs"
  all_orgs = true

  policy_config = {
    owner                             = "my-org"
    name                              = "Compromised Actions Policy - All Orgs"
    enable_compromised_actions_policy = true
  }
}

# Compromised Actions Policy Example (all_repos) - Blocks known compromised actions across all repos
resource "stepsecurity_github_run_policy" "compromised_actions_policy_all_repos" {
  owner     = "my-org"
  name      = "Compromised Actions Policy - All Repos"
  all_repos = true

  policy_config = {
    owner                             = "my-org"
    name                              = "Compromised Actions Policy - All Repos"
    enable_compromised_actions_policy = true
  }
}

# Compromised Actions Policy Example (dry_run) - Test compromised actions policy without enforcement
resource "stepsecurity_github_run_policy" "compromised_actions_policy_dry_run" {
  owner     = "my-org"
  name      = "Compromised Actions Policy - Dry Run"
  all_repos = true

  policy_config = {
    owner                             = "my-org"
    name                              = "Compromised Actions Policy - Dry Run"
    enable_compromised_actions_policy = true
    is_dry_run                        = true
  }
}

# Repository-Specific Policy Example - Applies action policy to specific repositories only
resource "stepsecurity_github_run_policy" "repo_specific_action_policy" {
  owner        = "my-org"
  name         = "Critical Repositories Action Policy"
  repositories = ["critical-app", "payment-service", "user-auth"]

  policy_config = {
    owner                = "my-org"
    name                 = "Critical Repositories Action Policy"
    enable_action_policy = true
    allowed_actions = {
      "actions/checkout"            = "allow"
      "step-security/harden-runner" = "allow"
      "actions/setup-node"          = "allow"
    }
  }
}

# Repository-Specific Policy Example - Applies runner policy to specific repositories only
resource "stepsecurity_github_run_policy" "repo_specific_runner_policy" {
  owner        = "my-org"
  name         = "Critical Repositories Runner Policy"
  repositories = ["critical-app", "payment-service"]

  policy_config = {
    owner                    = "my-org"
    name                     = "Critical Repositories Runner Policy"
    enable_runs_on_policy    = true
    disallowed_runner_labels = ["self-hosted", "windows-latest"]
  }
}

# For importing existing run policy to terraform state
# this will be helpful to manage existing policy using terraform
# alternative to this is to use terraform import command
import {
  to = stepsecurity_github_run_policy.action_policy_all_orgs
  id = "my-org/ACTUAL_POLICY_ID"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) The name of the run policy.
- `owner` (String) The GitHub organization or user that owns this policy.
- `policy_config` (Attributes) The configuration for this run policy. (see [below for nested schema](#nestedatt--policy_config))

### Optional

- `all_orgs` (Boolean) Whether this policy applies to all organizations.
- `all_repos` (Boolean) Whether this policy applies to all repositories in the organization.
- `repositories` (List of String) List of specific repositories this policy applies to.

### Read-Only

- `created_at` (String) The timestamp when this policy was created.
- `created_by` (String) The user who created this policy.
- `last_updated_at` (String) The timestamp when this policy was last updated.
- `last_updated_by` (String) The user who last updated this policy.
- `policy_id` (String) The unique identifier for this policy generated by StepSecurity.

<a id="nestedatt--policy_config"></a>
### Nested Schema for `policy_config`

Required:

- `name` (String) The name of the policy configuration.
- `owner` (String) The owner of the policy configuration.

Optional:

- `allowed_actions` (Map of String) Map of allowed actions and their permissions (e.g., 'actions/checkout': 'allow').
- `disallowed_runner_labels` (Set of String) Set of disallowed runner labels.
- `enable_action_policy` (Boolean) Whether to enable the action policy.
- `enable_compromised_actions_policy` (Boolean) Whether to enable the compromised actions policy.
- `enable_runs_on_policy` (Boolean) Whether to enable the runs-on policy.
- `enable_secrets_policy` (Boolean) Whether to enable the secrets policy.
- `exempted_users` (Set of String) Set of exempted users (can be bots/usernames) for the secrets exfiltration policy. These users will not be subject to the secrets policy checks.
- `is_dry_run` (Boolean) Whether this policy is in dry-run mode.

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
#!/bin/bash

# GitHub run policies can be imported using the owner and policy ID separated by a forward slash
# Format: owner/policy_id

# Replace 'my-org' with your GitHub organization name
# Replace 'policy-id-12345' with the actual policy ID from StepSecurity
terraform import stepsecurity_github_run_policy.action_policy my-org/policy-id-12345

# You can find the policy ID by:
# 1. Using the stepsecurity_github_run_policies data source
# 2. Checking the StepSecurity dashboard
# 3. Using the StepSecurity API directly:
#    GET https://agent.api.stepsecurity.io/v1/github/my-org/actions/run-policies
```
